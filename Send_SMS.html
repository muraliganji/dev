<!DOCTYPE html>
<html>
<head>
	<title>Send SMS Message</title>
	
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://sdk-cdn.mypurecloud.com/javascript/latest/purecloud-platform-client-v2.min.js"></script>

	<script type="text/javascript">

		const platformClient = require("platformClient");
		const client = platformClient.ApiClient.instance;
		client.setEnvironment(platformClient.PureCloudRegionHosts.us_west_2); // Genesys Cloud region
		let apiInstance = new platformClient.ConversationsApi();
		const conversationsApi = new platformClient.ConversationsApi();
		let conversationId = 'state';//urlParams.get('conversationId');

		//
		// NEED TO UPDATE
		// 		
		//// Manually set auth token or use loginImplicitGrant(...) or loginClientCredentialsGrant(...)
		//client.setAccessToken("jl-ocN6SVXO2ofs4VEC7CPAWZgJvr4mPB3AplRs_mrlGJj1GG8rVoU3TeYSDnZ9u2Vl94lfqDS0J4bbhadyJuA");
		
		$(document).ready(() => {
			// Authenticate with PureCloud
					// Local vars
			const urlParams = new URLSearchParams(window.location.search);
			const clientId = urlParams.get('clientId');
			const redirectUri = 'https://muraliganji.github.io/dev/Send_SMS.html';		
			client.loginImplicitGrant(clientId, redirectUri, {'state': conversationId})
			
				.then((data) => {
					console.log('Logged in with state: ' + JSON.stringify(data));
                    conversationId = data.state;
				})
				.catch((err) => {
                    console.error(err);
                    document.getElementById('number').value = 'cannot log in';
                })
		});
		
        function sendSMS() {
            let number = document.getElementById('number').value;		
			let queueId = document.getElementById('queueId').value;	
			let body = {
				  "queueId": queueId,
				  "toAddress": number,
				  "toAddressMessengerType": "SMS",
				  "useExistingConversation": true,
				  "externalContactId": ""
				}; // Object | Create outbound messaging conversation

			// Create an outbound messaging conversation.
			apiInstance.postConversationsMessages(body)
			  .then((data) => {
				console.log('postConversationsMessages success! data: ${JSON.stringify(data, null, 2)}');
			})
			.catch((err) => {
				console.log("There was a failure calling postConversationsMessages");
				console.error(err);
			});			
            			
        }		

	</script>
</head>
<body>
	
	<b>Queue ID</b><input id="queueId" type="text" label="Queue ID" value="7326b21c-0b65-4631-93fb-c799146c5631"/><br/>
	<b>Phone Number</b><input id="number" type="text" label="Number to send SMS" /> <br/>
    <input type="button" value="Send SMS" onclick="sendSMS();" />
</body>
</html>